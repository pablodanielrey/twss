bueno primero tengo que arreglar los problemas que tenía la entrega anterior.
en principio verificar bien los datos que se tiene el archivo final mergeado.
tomo la opción de la v2 que es mas simple en cuanto a ontologías voy a usar esa.

armo un script que lea el dataset original y genere un archivo links.ttl
con las personas que encuentra en el dataset.

esto sirve como base para generar los sameAs


---

ahora pruebo con uno de los actores listados.

https://raw.githubusercontent.com/pablodanielrey/twss/master/owl/data/Ian_Simmons

https://dbpedia.org/page/Ian_Simmons


es otro ian simmons.
que tema!!. analizar como si es el actor u otra persona.

--


por lo pronto voy a analizar el proceso que hizo ale en la teoría a ver si lo entendí bien.
busco Tom Hanks.
es una persona física asi que la url:

https://dbpedia.org/resource/Tom_Hanks

pablo@xiaomi:/src/github/facu-infor/twss/entrega4$ curl -I https://dbpedia.org/resource/Tom_Hanks
HTTP/2 303 
date: Wed, 12 May 2021 22:27:43 GMT
content-type: text/html; charset=UTF-8
content-length: 0
server: Virtuoso/08.03.3319 (Linux) x86_64-centos_6-linux-glibc2.12  VDB
location: http://dbpedia.org/page/Tom_Hanks
access-control-allow-credentials: true
access-control-allow-methods: HEAD, GET, POST, OPTIONS
access-control-allow-headers: Depth,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Accept-Encoding


pablo@xiaomi:/src/github/facu-infor/twss/entrega4$ curl -I -H "Accept: text/turtle" https://dbpedia.org/resource/Tom_Hanks
HTTP/2 303 
date: Wed, 12 May 2021 22:28:06 GMT
content-type: text/turtle
content-length: 0
server: Virtuoso/08.03.3319 (Linux) x86_64-centos_6-linux-glibc2.12  VDB
tcn: choice
vary: negotiate,accept
alternates: {"/data/Tom_Hanks.atom" 0.500000 {type application/atom+xml}}, {"/data/Tom_Hanks.jrdf" 0.600000 {type application/rdf+json}}, {"/data/Tom_Hanks.jsod" 0.500000 {type application/odata+json}}, {"/data/Tom_Hanks.json" 0.600000 {type application/json}}, {"/data/Tom_Hanks.jsonld" 0.500000 {type application/ld+json}}, {"/data/Tom_Hanks.n3" 0.800000 {type text/n3}}, {"/data/Tom_Hanks.nt" 0.800000 {type text/rdf+n3}}, {"/data/Tom_Hanks.ntriples" 0.500000 {type application/n-triples}}, {"/data/Tom_Hanks.ttl" 0.700000 {type text/turtle}}, {"/data/Tom_Hanks.xml" 0.950000 {type application/rdf+xml}}
link: <http://creativecommons.org/licenses/by-sa/3.0/>;rel="license",<http://dbpedia.mementodepot.org/timegate/http://dbpedia.org/resource/Tom_Hanks>; rel="timegate"
location: http://dbpedia.org/data/Tom_Hanks.ttl
access-control-allow-credentials: true
access-control-allow-methods: HEAD, GET, POST, OPTIONS
access-control-allow-headers: Depth,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Accept-Encoding

----

o sea que con la librería resource podría obtener el turtle analizando las cabeceras de las respuestas del http.
ahora también puedo usar el standard que explicó ale sobre que los datos sobre un recurso están en el namespace /data/

o sea en este caso puedo pedir directamente: https://dbpedia.org/data/Tom_Hanks.ttl

----

tripletas a obtener:

dbp:birthDate
dbp:occupation

los prefijos:
@prefix dbp:	<http://dbpedia.org/property/> .


la pagina de wikipedia es:

foaf:isPrimaryTopicOf

el namespace para foaf es: http://xmlns.com/foaf/0.1/


---


genere un script que toma las personas de la ontología y los busca en dbpedia. usnado el nombre como el enlace entre las 2.
el nombre primero se cambian los espacios por _  y depuses de lo codifica para que sea una url válida.
al consultar debpedia.org/data/Persona.ttl 
se obtiene el turtle de la persona y es posible procesar las tripetas retornadas de forma simple.


pablo@xiaomi:/src/github/facu-infor/twss/entrega4$ python3 src/download_persons_dbpedia.py 
Procesando : data/dataset-original.ttl
Buscando datos de  https://raw.githubusercontent.com/pablodanielrey/twss/master/owl/data/Katsuyuki_Konishi
Imprimiendo tripletas
http://dbpedia.org/resource/Katsuyuki_Konishi http://dbpedia.org/property/birthDate 1973-04-21
http://dbpedia.org/resource/Katsuyuki_Konishi http://dbpedia.org/property/occupation http://dbpedia.org/resource/Voice_acting_in_Japan
http://dbpedia.org/resource/Katsuyuki_Konishi http://xmlns.com/foaf/0.1/isPrimaryTopicOf http://en.wikipedia.org/wiki/Katsuyuki_Konishi

------


Ale aclaró en el foro que hayq ue hacer el procesamiento de las redirecciones.
por lo que las urls de los recursos de dbpedia al tratarse de entidades físicas es /resource/

genero un script parcial para ver si resuelve el procesamiento de redirecciones.
con por ejemplo la url de la persona:
http://dbpedia.org/resource/Katsuyuki_Konishi



para debuggear el proceso chequeo con curl.

pablo@xiaomi:/src/github/facu-infor/twss$ curl -I -H 'Accept: text/turtle'  https://dbpedia.org/resource/Katsuyuki_Konishi
HTTP/2 303 
date: Thu, 13 May 2021 16:48:58 GMT
content-type: text/turtle
content-length: 0
server: Virtuoso/08.03.3319 (Linux) x86_64-centos_6-linux-glibc2.12  VDB
tcn: choice
vary: negotiate,accept
alternates: {"/data/Katsuyuki_Konishi.atom" 0.500000 {type application/atom+xml}}, {"/data/Katsuyuki_Konishi.jrdf" 0.600000 {type application/rdf+json}}, {"/data/Katsuyuki_Konishi.jsod" 0.500000 {type application/odata+json}}, {"/data/Katsuyuki_Konishi.json" 0.600000 {type application/json}}, {"/data/Katsuyuki_Konishi.jsonld" 0.500000 {type application/ld+json}}, {"/data/Katsuyuki_Konishi.n3" 0.800000 {type text/n3}}, {"/data/Katsuyuki_Konishi.nt" 0.800000 {type text/rdf+n3}}, {"/data/Katsuyuki_Konishi.ntriples" 0.500000 {type application/n-triples}}, {"/data/Katsuyuki_Konishi.ttl" 0.700000 {type text/turtle}}, {"/data/Katsuyuki_Konishi.xml" 0.950000 {type application/rdf+xml}}
link: <http://creativecommons.org/licenses/by-sa/3.0/>;rel="license",<http://dbpedia.mementodepot.org/timegate/http://dbpedia.org/resource/Katsuyuki_Konishi>; rel="timegate"
location: http://dbpedia.org/data/Katsuyuki_Konishi.ttl
access-control-allow-credentials: true
access-control-allow-methods: HEAD, GET, POST, OPTIONS
access-control-allow-headers: Depth,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Accept-Encoding


y me retonra los siguientes contenidos alternativos.


{
    "/data/Katsuyuki_Konishi.atom" 0.500000 {type application/atom+xml
    }
},
{
    "/data/Katsuyuki_Konishi.jrdf" 0.600000 {type application/rdf+json
    }
},
{
    "/data/Katsuyuki_Konishi.jsod" 0.500000 {type application/odata+json
    }
},
{
    "/data/Katsuyuki_Konishi.json" 0.600000 {type application/json
    }
},
{
    "/data/Katsuyuki_Konishi.jsonld" 0.500000 {type application/ld+json
    }
},
{
    "/data/Katsuyuki_Konishi.n3" 0.800000 {type text/n3
    }
},
{
    "/data/Katsuyuki_Konishi.nt" 0.800000 {type text/rdf+n3
    }
},
{
    "/data/Katsuyuki_Konishi.ntriples" 0.500000 {type application/n-triples
    }
},
{
    "/data/Katsuyuki_Konishi.ttl" 0.700000 {type text/turtle
    }
},
{
    "/data/Katsuyuki_Konishi.xml" 0.950000 {type application/rdf+xml
    }
}

por lo que deberia obtener esa cabecera y matchear por le content-type que necesito.
en el caso de que se corresponda con text/turtle
obtengo el link a acceeder. en este caso.

/data/Katsuyuki_Konishi.ttl

-----


igualmente leo aca que el header Alternates ha sido abandonado.
parece que dbpedia lo usa.
me baso en ese header para obtener las urls alternativas.


https://developer.mozilla.org/en-US/docs/Web/HTTP/Content_negotiation

----


ahi cree un script que analiza el requerimiento y sigue las redirecciones.
tira la url que asocia el servidor con el content type text/turtle.

pablo@xiaomi:/src/github/facu-infor/twss$ python3 entrega4/src/process_redirections_to_turtle.py https://dbpedia.org/resource/Katsuyuki_Konishi
/data/Katsuyuki_Konishi.ttl
pablo@xiaomi:/src/github/facu-infor/twss$ python3 entrega4/src/process_redirections_to_turtle.py https://dbpedia.org/resource/Katsuyuki
/data/Katsuyuki.ttl
pablo@xiaomi:/src/github/facu-infor/twss$ python3 entrega4/src/process_redirections_to_turtle.py https://dbpedia.org/resource/Katsu
/data/Katsu.ttl
pablo@xiaomi:/src/github/facu-infor/twss$ python3 entrega4/src/process_redirections_to_turtle.py https://dbpedia.org/resource/alg_32
/data/alg_32.ttl
pablo@xiaomi:/src/github/facu-infor/twss$ 

veo que siempre redirije ciegamente a la url /resource/

-------------------


ahora igualmente me doy cuenta que la cabecera alternates no hacía falta.
veo que location redirige al contenido correctamente.
y ya tiene en cuenta con location la redirección de http a https.

modifico el script, queda mucho mas simple.
no uso expresiones regulares.

-----------------

después de desarrollar el script veo que las redirecciones están directamente en el header Location:
con lo cual podemos decirle a requests que siga las redirecciones y nos va a obtener el turtle directamente.

pablo@xiaomi:/src/github/facu-infor/twss$ curl -I -H 'Accept: text/turtle'  https://dbpedia.org/resource/Katsuyuki_Konishi
HTTP/2 303 
date: Thu, 13 May 2021 19:15:39 GMT
content-type: text/turtle
content-length: 0
server: Virtuoso/08.03.3319 (Linux) x86_64-centos_6-linux-glibc2.12  VDB
tcn: choice
vary: negotiate,accept
alternates: {"/data/Katsuyuki_Konishi.atom" 0.500000 {type application/atom+xml}}, {"/data/Katsuyuki_Konishi.jrdf" 0.600000 {type application/rdf+json}}, {"/data/Katsuyuki_Konishi.jsod" 0.500000 {type application/odata+json}}, {"/data/Katsuyuki_Konishi.json" 0.600000 {type application/json}}, {"/data/Katsuyuki_Konishi.jsonld" 0.500000 {type application/ld+json}}, {"/data/Katsuyuki_Konishi.n3" 0.800000 {type text/n3}}, {"/data/Katsuyuki_Konishi.nt" 0.800000 {type text/rdf+n3}}, {"/data/Katsuyuki_Konishi.ntriples" 0.500000 {type application/n-triples}}, {"/data/Katsuyuki_Konishi.ttl" 0.700000 {type text/turtle}}, {"/data/Katsuyuki_Konishi.xml" 0.950000 {type application/rdf+xml}}
link: <http://creativecommons.org/licenses/by-sa/3.0/>;rel="license",<http://dbpedia.mementodepot.org/timegate/http://dbpedia.org/resource/Katsuyuki_Konishi>; rel="timegate"
location: http://dbpedia.org/data/Katsuyuki_Konishi.ttl
access-control-allow-credentials: true
access-control-allow-methods: HEAD, GET, POST, OPTIONS
access-control-allow-headers: Depth,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Accept-Encoding

-----

pablo@xiaomi:/src/github/facu-infor/twss$ python3 entrega4/src/process_redirections_to_turtle.py http://dbpedia.org/resource/Katsuyuki
@prefix foaf:   <http://xmlns.com/foaf/0.1/> .
@prefix wikipedia-en:   <http://en.wikipedia.org/wiki/> .
@prefix dbr:    <http://dbpedia.org/resource/> .
wikipedia-en:Katsuyuki  foaf:primaryTopic       dbr:Katsuyuki .
@prefix rdf:    <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix wikidata:       <http://www.wikidata.org/entity/> .
dbr:Katsuyuki   rdf:type        wikidata:Q82799 .
@prefix yago:   <http://dbpedia.org/class/yago/> .
dbr:Katsuyuki   rdf:type        yago:LanguageUnit106284225 ,
                yago:Name106333653 ,
                wikidata:Q202444 ,
                yago:Relation100031921 ,
                yago:Part113809207 .
@prefix dbo:    <http://dbpedia.org/ontology/> .
dbr:Katsuyuki   rdf:type        dbo:Name .
@prefix owl:    <http://www.w3.org/2002/07/owl#> .
dbr:Katsuyuki   rdf:type        owl:Thing ,
                yago:Abstraction100002137 ,
                dbo:GivenName ,
                yago:FirstName106337307 .
@prefix rdfs:   <http://www.w3.org/2000/01/rdf-schema#> .
dbr:Katsuyuki   rdfs:label      "Katsuyuki"@en ;
        foaf:name       "Katsuyuki"@en ;
        foaf:isPrimaryTopicOf   wikipedia-en:Katsuyuki .
@prefix dct:    <http://purl.org/dc/terms/> .
@prefix dbc:    <http://dbpedia.org/resource/Category:> .
dbr:Katsuyuki   dct:subject     dbc:Japanese_masculine_given_names ;
        owl:sameAs      wikidata:Q6378245 ,
                <https://global.dbpedia.org/id/4pHR2> ,
                dbr:Katsuyuki .
@prefix prov:   <http://www.w3.org/ns/prov#> .
dbr:Katsuyuki   prov:wasDerivedFrom     <http://en.wikipedia.org/wiki/Katsuyuki?oldid=941729380&ns=0> .
@prefix dbp:    <http://dbpedia.org/property/> .
dbr:Katsuyuki   dbp:origin      "Japanese"@en ;
        dbp:meaning     "Different meanings depending on the kanji used"@en ;
        dbp:gender      "Male"@en ;
        dbp:name        "Katsuyuki"@en ;
        dbo:wikiPageID  36156911 ;
        dbo:wikiPageRevisionID  941729380 ;
        dbo:wikiPageWikiLink    dbr:Katsuyuki_Masuchi ,
                dbr:Katsuyuki_Tanamura ,
                dbr:Katsuyuki_Abe ,
                dbr:Katsuyuki_Aihara ,
                dbr:Katsuyuki_Dobashi ,
                dbr:Katsuyuki_Kawachi ,
                dbr:Katsuyuki_Hiranaka ,
                dbr:Katsuyuki_Sakai ,
                dbr:Katsuyuki_Miyazawa ,
                <http://dbpedia.org/resource/Katsuyuki_Kond\u014D> ,
                dbr:Katsuyuki_Saito ,
                dbr:Katsuyuki_Kiyomiya ,
                dbr:Katsuyuki_Minami ,
                dbr:Katsuyuki_Nakasuga ,
                dbr:Katsuyuki_Konishi ,
                dbr:Katsuyuki_Kawai ,
                dbr:Katsuyuki_Itakura ,
                dbr:Katsuyuki_Hirano ,
                dbr:Katsuyuki_Murai ,
                dbr:Kanji ,
                dbc:Japanese_masculine_given_names ,
                dbr:Katsuyuki_Miyajima .
@prefix dbt:    <http://dbpedia.org/resource/Template:> .
dbr:Katsuyuki   dbp:wikiPageUsesTemplate        dbt:Nihongo2 ,
                dbt:Given_name ,
                dbt:Nihongo ,
                dbt:Infobox_given_name .
@prefix xsd:    <http://www.w3.org/2001/XMLSchema#> .
dbr:Katsuyuki   dbo:wikiPageLength      "2219"^^xsd:nonNegativeInteger ;
        dbo:wikiPageDisambiguates       dbr:Katsuyuki_Kiyomiya ,
                dbr:Katsuyuki_Itakura ,
                dbr:Katsuyuki_Dobashi ,
                dbr:Katsuyuki_Murai ,
                dbr:Katsuyuki_Kawachi ,
                dbr:Katsuyuki_Aihara ,
                dbr:Katsuyuki_Sakai ,
                dbr:Katsuyuki_Miyazawa ,
                dbr:Katsuyuki_Abe ,
                dbr:Katsuyuki_Saito ,
                dbr:Katsuyuki_Miyajima ,
                dbr:Katsuyuki_Nakasuga ,
                <http://dbpedia.org/resource/Katsuyuki_Kond\u014D> ,
                dbr:Katsuyuki_Tanamura ,
                dbr:Katsuyuki_Masuchi ,
                dbr:Katsuyuki_Hiranaka ,
                dbr:Katsuyuki_Konishi ,
                dbr:Katsuyuki_Kawai ,
                dbr:Katsuyuki_Hirano ,
                dbr:Katsuyuki_Minami ;
        dbo:meaning     "Different meanings depending on thekanjiused" .

---

bueno es muy simple el script que hay que realizar.
voy a consultarle a casco y a diego a ver si hace falta algo mas.


----

implemento la parte de leer los 2 ttls y consutlar el turtle a partir del sameAs.
para simplificar la generación del turtle armo un script que tome las personas y les asigne el owl:sameAs 
con la url de /resource/ de dbpedia.

ahi termine el script.
generate_sameAs.py

----

ahora probando una de las personas cuando accedo a :

https://dbpedia.org/resource/Aaron%20Taylor-Johnson

veo que redirije a la página de la persona y dice que no existe el recurso.
The requested entity is unknown)

me da curiosidad ver si dbpedia tira algo en http cuando se consulta el recurso original.


-----

retorna la redirección al /data/ 
y el /data/ tira error de consulta sparql!!!!

pablo@xiaomi:/src/github/facu-infor/twss/entrega4$ curl -I -H 'Accept: text/turtle' https://dbpedia.org/resource/Aaron%20Taylor-Johnson
HTTP/2 303 
date: Thu, 13 May 2021 20:41:26 GMT
content-type: text/turtle
content-length: 0
server: Virtuoso/08.03.3319 (Linux) x86_64-centos_6-linux-glibc2.12  VDB
tcn: choice
vary: negotiate,accept
alternates: {"/data/Aaron%20Taylor-Johnson.atom" 0.500000 {type application/atom+xml}}, {"/data/Aaron%20Taylor-Johnson.jrdf" 0.600000 {type application/rdf+json}}, {"/data/Aaron%20Taylor-Johnson.jsod" 0.500000 {type application/odata+json}}, {"/data/Aaron%20Taylor-Johnson.json" 0.600000 {type application/json}}, {"/data/Aaron%20Taylor-Johnson.jsonld" 0.500000 {type application/ld+json}}, {"/data/Aaron%20Taylor-Johnson.n3" 0.800000 {type text/n3}}, {"/data/Aaron%20Taylor-Johnson.nt" 0.800000 {type text/rdf+n3}}, {"/data/Aaron%20Taylor-Johnson.ntriples" 0.500000 {type application/n-triples}}, {"/data/Aaron%20Taylor-Johnson.ttl" 0.700000 {type text/turtle}}, {"/data/Aaron%20Taylor-Johnson.xml" 0.950000 {type application/rdf+xml}}
link: <http://creativecommons.org/licenses/by-sa/3.0/>;rel="license",<http://dbpedia.mementodepot.org/timegate/http://dbpedia.org/resource/Aaron%20Taylor-Johnson>; rel="timegate"
location: http://dbpedia.org/data/Aaron%20Taylor-Johnson.ttl
access-control-allow-credentials: true
access-control-allow-methods: HEAD, GET, POST, OPTIONS
access-control-allow-headers: Depth,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Accept-Encoding


----

https://dbpedia.org/data/Aaron%20Taylor-Johnson.ttl

Virtuoso 37000 Error SP030: SPARQL compiler, line 4: syntax error at '<' before 'local:'

SPARQL query:
define output:format "HTTP+TTL text/turtle" 
#output-format:text/turtle
define input:default-graph-uri <http://dbpedia.org>
prefix owl: <http://www.w3.org/2002/07/owl#> CONSTRUCT { <local:/resource/Aaron Taylor-Johnson> `sql:dbp_replace (?p1)` `sql:dbp_replace (?o1)` . `sql:dbp_replace (?s2)` `sql:dbp_replace (?p2)` <local:/resource/Aaron Taylor-Johnson> . <local:/resource/Aaron Taylor-Johnson> owl:sameAs <http://dbpedia.org/resource/Aaron Taylor-Johnson> . } WHERE { { <http://dbpedia.org/resource/Aaron Taylor-Johnson> ?p1 ?o1 } UNION { ?s2 ?p2 <http://dbpedia.org/resource/Aaron Taylor-Johnson> } }


uooouuu. hasta te da la consulta!!!.
me suena a que si existe alguna versión de sql injection en sparql aca se puede aplicar!!!. problema de seguriadad!!!.


-------------------


siguiendo con el ejercicio.
entiendo que dbpedia.org realiza consultas sparql con lo que le pongamos como parámetro después de /data/
y si. al consutlar el data tira 400 si no existe el recurso.

pablo@xiaomi:/src/github/facu-infor/twss/entrega4$ curl -I -H 'Accept: text/turtle' https://dbpedia.org/data/Aaron%20Taylor-Johnson
HTTP/2 400 
date: Thu, 13 May 2021 20:48:57 GMT
content-type: text/plain
content-length: 672
server: Virtuoso/08.03.3319 (Linux) x86_64-centos_6-linux-glibc2.12  VDB
access-control-allow-credentials: true
access-control-allow-methods: HEAD, GET, POST, OPTIONS
access-control-allow-headers: Depth,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Accept-Encoding

pablo@xiaomi:/src/github/facu-infor/twss/entrega4$ 

-----

o sea que puedo detectar las peronas que existen en base al nombre.


https://dbpedia.org/page/Paul_Briggs
fijarse que se tiene 
dbo:wikiPageDisambiguates
dbo:wikiPageWikiLink


----


ya teniendo una idea de que es lo necesario para consultar dbpedia y seguir las redirecciones,
primero me voy a asegurar la entrega, asi que armo el archivo links a mano y testeo a ver que pueda obtener todo.

tengo el prototipo funcionando.
tengo que extraer las tripletas de los datos que necesito pero me surge una duda:

tengo 2 propiedades iguales:

https://dbpedia.org/ontology/birthDate
https://dbpedia.org/property/birthDate

una que viene de la ontología y otro de las propieadades de dbpedia.
la version de la propiedad no se encuentra en formato turtle.

pablo@xiaomi:~$ curl -H 'Accept: text/turtle' https://dbpedia.org/property/birthDate
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
<title>406 Not Acceptable</title>
</head><body>
<h1>406 Not Acceptable</h1>
<p>An appropriate representation of the requested resource birthDate could not be found on this server.</p>
Available variant(s):
<ul>
<li><a href="birthDate">birthDate</a> , type text/html, charset UTF-8</li>
</ul>
</body></html>

pablo@xiaomi:~$ curl -I -H 'Accept: text/turtle' https://dbpedia.org/property/birthDate
HTTP/2 406 
date: Mon, 17 May 2021 17:59:58 GMT
content-type: text/html; charset=UTF-8
content-length: 371
server: Virtuoso/08.03.3319 (Linux) x86_64-centos_6-linux-glibc2.12  VDB
alternates: {"birthDate" 1 {type text/html} {charset UTF-8} {length 12096}}
access-control-allow-credentials: true
access-control-allow-methods: HEAD, GET, POST, OPTIONS
access-control-allow-headers: Depth,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Accept-Encoding

pablo@xiaomi:~$ 


-----------------


la version de la ontología teóricamente se encuentra en turtle.
pero no me la deja obtener.

pablo@xiaomi:~$ curl -I -H 'Accept: text/turtle' https://dbpedia.org/ontology/birthDate
HTTP/2 303 
date: Mon, 17 May 2021 18:00:34 GMT
content-type: text/turtle
content-length: 0
server: Virtuoso/08.03.3319 (Linux) x86_64-centos_6-linux-glibc2.12  VDB
location: http://dbpedia.org/data3/birthDate.ttl
access-control-allow-credentials: true
access-control-allow-methods: HEAD, GET, POST, OPTIONS
access-control-allow-headers: Depth,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Accept-Encoding


pablo@xiaomi:~$ curl -I -H 'Accept: text/turtle' http://dbpedia.org/data3/birthDate.ttl
HTTP/1.1 303 See Other
Server: nginx/1.18.0
Date: Mon, 17 May 2021 18:01:21 GMT
Content-Type: text/html
Content-Length: 153
Connection: keep-alive
Location: https://dbpedia.org/data3/birthDate.ttl
Access-Control-Allow-Credentials: true
Access-Control-Allow-Methods: HEAD, GET, POST, OPTIONS
Access-Control-Allow-Headers: Depth,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Accept-Encoding


pablo@xiaomi:~$ curl -I https://dbpedia.org/data3/birthDate.ttl
HTTP/2 200 
date: Mon, 17 May 2021 18:02:56 GMT
content-type: text/turtle; charset=UTF-8
content-length: 1676
server: Virtuoso/08.03.3319 (Linux) x86_64-centos_6-linux-glibc2.12  VDB
x-sparql-default-graph: http://dbpedia.org/resource/classes#
content-disposition: filename=sparql_2021-05-17_18-02-58Z.ttl
expires: Mon, 24 May 2021 18:02:56 GMT
cache-control: max-age=604800
access-control-allow-credentials: true
access-control-allow-methods: HEAD, GET, POST, OPTIONS
access-control-allow-headers: Depth,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Accept-Encoding
accept-ranges: bytes

pablo@xiaomi:~$ curl https://dbpedia.org/data3/birthDate.ttl
@prefix ns0:	<http://open.vocab.org/terms/> .
@prefix dbo:	<http://dbpedia.org/ontology/> .
<http://dbpedia.org/ontology/>	ns0:defines	dbo:birthDate .
<http://dbpedia.org/ontology/data/definitions.ttl>	ns0:describes	dbo:birthDate .
@prefix rdf:	<http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix owl:	<http://www.w3.org/2002/07/owl#> .
dbo:birthDate	rdf:type	owl:FunctionalProperty ,
		rdf:Property ,
		owl:DatatypeProperty .
@prefix wikidata:	<http://www.wikidata.org/entity/> .
dbo:birthDate	owl:equivalentProperty	wikidata:P569 .
@prefix schema:	<http://schema.org/> .
dbo:birthDate	owl:equivalentProperty	schema:birthDate .
@prefix ns6:	<https://d-nb.info/standards/elementset/gnd#> .
dbo:birthDate	owl:equivalentProperty	ns6:dateOfBirth .
@prefix rdfs:	<http://www.w3.org/2000/01/rdf-schema#> .
dbo:birthDate	rdfs:label	"date de naissance"@fr ,
		"\u099C\u09A8\u09CD\u09AE\u09A6\u09BF\u09A8"@bn ,
		"d\u00E1ta breithe"@ga ,
		"data de naixement"@ca ,
		"birth date"@en ,
		"\u751F\u5E74\u6708\u65E5"@ja ,
		"\u03B7\u03BC\u03B5\u03C1\u03BF\u03BC\u03B7\u03BD\u03AF\u03B1_\u03B3\u03AD\u03BD\u03BD\u03B7\u03C3\u03B7\u03C2"@el ,
		"data urodzenia"@pl ,
		"Geburtsdatum"@de ,
		"geboortedatum"@nl ;
	rdfs:domain	dbo:Person .
@prefix xsd:	<http://www.w3.org/2001/XMLSchema#> .
dbo:birthDate	rdfs:range	xsd:date ;
	rdfs:isDefinedBy	dbo: .
@prefix wdrs:	<http://www.w3.org/2007/05/powder-s#> .
dbo:birthDate	wdrs:describedby	<http://dbpedia.org/ontology/data/definitions.ttl> ;
	owl:sameAs	dbo:birthDate .
@prefix prov:	<http://www.w3.org/ns/prov#> .
@prefix ns11:	<http://mappings.dbpedia.org/index.php/OntologyProperty:> .
dbo:birthDate	prov:wasDerivedFrom	ns11:birthDate .


no entiendo por que están definidas las mismas propieades en distintos espacios de nombres.
consulto al foro.

----


me esta funcionado el obtener los datos asociados.

pablo@xiaomi:/src/github/facu-infor/twss/entrega4$ python3 src/entrega.py  > /tmp/p.ttl

me deja para Alexander_Skarsgård

twssd:Alexander_Skarsgård ns2:birthDate "1976-08-25"^^xsd:date ;
    ns2:occupation dbr:Alexander_Skarsgård__PersonFunction__1 ;
    ns1:sameAs dbr:Alexander_Skarsgård .

<https://raw.githubusercontent.com/pablodanielrey/twss/master/owl/data/Alexander_Skarsg%C3%A5rd> a schema:Person,
        ns1:NamedIndividual ;
    schema:name "Alexander Skarsgård" .

veo que se obtiene la ocupacion y la fecha de cumpleaños pero se asocian al mismo o distinto individual?
no se como se trata el tema de escapar la iri. si es equivalnete a escribirla en utf8?

---

analizo por ejemplo a Antonio Banderas.
me tira la ocupación:
https://dbpedia.org/resource/Antonio_Banderas__PersonFunction__1


pablo@xiaomi:/src/github/facu-infor/twss/entrega4$ curl -I -H 'Accept: text/turtle' https://dbpedia.org/resource/Antonio_Banderas__PersonFunction__1
HTTP/2 303 
date: Mon, 17 May 2021 20:54:29 GMT
content-type: text/turtle
content-length: 0
server: Virtuoso/08.03.3319 (Linux) x86_64-centos_6-linux-glibc2.12  VDB
tcn: choice
vary: negotiate,accept
alternates: {"/data/Antonio_Banderas__PersonFunction__1.atom" 0.500000 {type application/atom+xml}}, {"/data/Antonio_Banderas__PersonFunction__1.jrdf" 0.600000 {type application/rdf+json}}, {"/data/Antonio_Banderas__PersonFunction__1.jsod" 0.500000 {type application/odata+json}}, {"/data/Antonio_Banderas__PersonFunction__1.json" 0.600000 {type application/json}}, {"/data/Antonio_Banderas__PersonFunction__1.jsonld" 0.500000 {type application/ld+json}}, {"/data/Antonio_Banderas__PersonFunction__1.n3" 0.800000 {type text/n3}}, {"/data/Antonio_Banderas__PersonFunction__1.nt" 0.800000 {type text/rdf+n3}}, {"/data/Antonio_Banderas__PersonFunction__1.ntriples" 0.500000 {type application/n-triples}}, {"/data/Antonio_Banderas__PersonFunction__1.ttl" 0.700000 {type text/turtle}}, {"/data/Antonio_Banderas__PersonFunction__1.xml" 0.950000 {type application/rdf+xml}}
link: <http://creativecommons.org/licenses/by-sa/3.0/>;rel="license",<http://dbpedia.mementodepot.org/timegate/http://dbpedia.org/resource/Antonio_Banderas__PersonFunction__1>; rel="timegate"
location: http://dbpedia.org/data/Antonio_Banderas__PersonFunction__1.ttl
access-control-allow-credentials: true
access-control-allow-methods: HEAD, GET, POST, OPTIONS
access-control-allow-headers: Depth,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Accept-Encoding

pablo@xiaomi:/src/github/facu-infor/twss/entrega4$ curl -I -H 'accept: text/turtle' http://dbpedia.org/data/Antonio_Banderas__PersonFunction__1.ttl
HTTP/1.1 303 See Other
Server: nginx/1.18.0
Date: Mon, 17 May 2021 20:55:08 GMT
Content-Type: text/html
Content-Length: 153
Connection: keep-alive
Location: https://dbpedia.org/data/Antonio_Banderas__PersonFunction__1.ttl
Access-Control-Allow-Credentials: true
Access-Control-Allow-Methods: HEAD, GET, POST, OPTIONS
Access-Control-Allow-Headers: Depth,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Accept-Encoding

pablo@xiaomi:/src/github/facu-infor/twss/entrega4$ curl -I -H 'accept: text/turtle' https://dbpedia.org/data/Antonio_Banderas__PersonFunction__1.ttl
HTTP/2 200 
date: Mon, 17 May 2021 20:55:16 GMT
content-type: text/turtle; charset=UTF-8
content-length: 507
server: Virtuoso/08.03.3319 (Linux) x86_64-centos_6-linux-glibc2.12  VDB
expires: Mon, 24 May 2021 20:55:16 GMT
link: <http://creativecommons.org/licenses/by-sa/3.0/>;rel="license",<http://dbpedia.org/data/Antonio_Banderas__PersonFunction__1.xml>; rel="alternate"; type="application/rdf+xml"; title="Structured Descriptor Document (RDF/XML format)", <http://dbpedia.org/data/Antonio_Banderas__PersonFunction__1.n3>; rel="alternate"; type="text/n3"; title="Structured Descriptor Document (N3/Turtle format)", <http://dbpedia.org/data/Antonio_Banderas__PersonFunction__1.json>; rel="alternate"; type="application/json"; title="Structured Descriptor Document (RDF/JSON format)", <http://dbpedia.org/data/Antonio_Banderas__PersonFunction__1.atom>; rel="alternate"; type="application/atom+xml"; title="OData (Atom+Feed format)", <http://dbpedia.org/data/Antonio_Banderas__PersonFunction__1.jsod>; rel="alternate"; type="application/odata+json"; title="OData (JSON format)", <http://dbpedia.org/page/Antonio_Banderas__PersonFunction__1>; rel="alternate"; type="text/html"; title="XHTML+RDFa", <http://dbpedia.org/resource/Antonio_Banderas__PersonFunction__1>; rel="http://xmlns.com/foaf/0.1/primaryTopic", <http://dbpedia.org/resource/Antonio_Banderas__PersonFunction__1>; rev="describedby", <http://dbpedia.mementodepot.org/timegate/http://dbpedia.org/data/Antonio_Banderas__PersonFunction__1.ttl>; rel="timegate"
x-sparql-default-graph: http://dbpedia.org
content-disposition: filename=sparql_2021-05-17_20-55-19Z.ttl
cache-control: max-age=604800
access-control-allow-credentials: true
access-control-allow-methods: HEAD, GET, POST, OPTIONS
access-control-allow-headers: Depth,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Accept-Encoding
accept-ranges: bytes

pablo@xiaomi:/src/github/facu-infor/twss/entrega4$ curl -H 'accept: text/turtle' https://dbpedia.org/data/Antonio_Banderas__PersonFunction__1.ttl
@prefix dbo:    <http://dbpedia.org/ontology/> .
@prefix dbr:    <http://dbpedia.org/resource/> .
dbr:Antonio_Banderas    dbo:occupation  dbr:Antonio_Banderas__PersonFunction__1 .
@prefix rdf:    <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
dbr:Antonio_Banderas__PersonFunction__1 rdf:type        dbo:PersonFunction .
@prefix owl:    <http://www.w3.org/2002/07/owl#> .
dbr:Antonio_Banderas__PersonFunction__1 rdf:type        owl:Thing ;
        owl:sameAs      dbr:Antonio_Banderas__PersonFunction__1 ;
        dbo:title       "Actor, producer, director"@en .


veo que para desreferenciar estos datos debería chequear que sea :
dbo:PersonFunction
dbo:title <--- datos requeridos

-----

también ahi veo la relación entre dbo:occupation y dbp:occupation


....	dbo:occupation	dbr:Antonio_Banderas__PersonFunction__1 .
....    dbp:occupation	"Actor, producer, director"@en ;

en el caso de object properties ya están desreferenciadas las propieades. asumo que es un tema de que generan los datos asociados al los .ttl
usando consultas sparql y ya las desreferencian ahí. (o sea no es que se defina normalmente la ontología así)

----

tomé la opción mas compleja y desreferencio la iri de la ocupación.
creo que es a lo que se refería ale cuando decía que tenemos que desreferenciar todo.

twssd:Antonio_Banderas a schema:Person,
        ns1:NamedIndividual ;
    dbo:birthDate "1960-08-10"^^xsd:date ;
    dbo:title "Actor, producer, director"@en ;
    schema:name "Antonio Banderas" ;
    ns1:sameAs dbr:Antonio_Banderas .

andubo ok. me trajo dbo:title de la ocupación y la asigné al iri de mi dominio.
después tengo que hacer la traslación de las propiedades de dbpedia a propieades definidas dentro de mi ontología.



------

para el caso de la wifi veo que se puede obtener usando la propiedad. foaf:primaryTopic

@prefix wikipedia-en:	<http://en.wikipedia.org/wiki/> .
wikipedia-en:Antonio_Banderas	foaf:primaryTopic	dbr:Antonio_Banderas .

o también puedo usar la inversa:

@prefix wikipedia-en:	<http://en.wikipedia.org/wiki/> .
dbr:Antonio_Banderas foaf:isPrimaryTopicOf	wikipedia-en:Antonio_Banderas .

para mi es mas simple usar la inversa.


perfecto, adapté el script y funcionó.

twssd:Antonio_Banderas a schema:Person,
        ns1:NamedIndividual ;
    dbo:birthDate "1960-08-10"^^xsd:date ;
    dbo:title "Actor, producer, director"@en ;
    schema:name "Antonio Banderas" ;
    ns1:sameAs dbr:Antonio_Banderas ;
    foaf:isPrimaryTopicOf wiki:Antonio_Banderas .


no desreferencio la wifi porque no trae ninguna info en turtle.

pablo@xiaomi:~$ curl -I -H 'accept: text/turtle' https://en.wikipedia.org/wiki/Antonio_Banderas
HTTP/2 200 
date: Mon, 17 May 2021 07:19:04 GMT
vary: Accept-Encoding,Cookie,Authorization
server: ATS/8.0.8
x-content-type-options: nosniff
p3p: CP="See https://en.wikipedia.org/wiki/Special:CentralAutoLogin/P3P for more info."
content-language: en
x-request-id: 5cc877c5-3123-48ff-8a54-d1304bcc4842
last-modified: Sun, 16 May 2021 06:48:33 GMT
content-type: text/html; charset=UTF-8
age: 54535
x-cache: cp1085 miss, cp1079 hit/25
x-cache-status: hit-front
server-timing: cache;desc="hit-front", host;desc="cp1079"
strict-transport-security: max-age=106384710; includeSubDomains; preload
report-to: { "group": "wm_nel", "max_age": 86400, "endpoints": [{ "url": "https://intake-logging.wikimedia.org/v1/events?stream=w3c.reportingapi.network_error&schema_uri=/w3c/reportingapi/network_error/1.0.0" }] }
nel: { "report_to": "wm_nel", "max_age": 86400, "failure_fraction": 0.05, "success_fraction": 0.0}
permissions-policy: interest-cohort=()
set-cookie: WMF-Last-Access=17-May-2021;Path=/;HttpOnly;secure;Expires=Fri, 18 Jun 2021 12:00:00 GMT
set-cookie: WMF-Last-Access-Global=17-May-2021;Path=/;Domain=.wikipedia.org;HttpOnly;secure;Expires=Fri, 18 Jun 2021 12:00:00 GMT
x-client-ip: 191.84.252.51
cache-control: private, s-maxage=0, max-age=0, must-revalidate
set-cookie: GeoIP=AR:B:La_Plata:-34.93:-57.95:v4; Path=/; secure; Domain=.wikipedia.org
accept-ranges: bytes
content-length: 270885



---------------------------


consulta par el foro!!!! acordarme!!!.
tenemos las siguientes definiciones en turtle:

dbo:birthDate rdfs:domain	dbo:Person .

dbo:Person	owl:equivalentClass	schema:Person .

twssd:Person rdfs:type schema:Person .

como la semántica de equivalentClass no es igual a sameAs (como explicó ale en el foro) entonces no se puede usar la propiedad para dominio = twssd:Person
asi que genero una nueva.

consultaría la foro si en el caso de tener sameAs si se podría usar la misma propiedad?

referencias:
https://www.w3.org/TR/rdf-schema/#ch_domain
https://www.w3.org/TR/owl2-syntax/#Equivalent_Data_Properties


-------

implemente las transformaciones de propiedades de la ontología de dbpedia 
a mi ontología.

dbo:birthDate --> twsse2:birthDate
dbo:occupation --> blank node + asignación de occupation.


ej:

twssd:Antonio_Banderas a schema:Person,
        ns1:NamedIndividual ;
    schema:name "Antonio Banderas" ;
    ns1:sameAs dbr:Antonio_Banderas ;
    foaf:isPrimaryTopicOf wiki:Antonio_Banderas ;
    twsse2:birthDate "1960-08-10"^^xsd:date ;
    twsse2:hasOccupation [ a twsse2:Occupation ;
            twsse2:name "Actor, producer, director"@en ] .

ahora voy a separar las ocupaciones por ,
asi tengo varias asignaciones como debería ser.


----

después de modificar el script me genera perfecto las ocupaciones.


twssd:Antonio_Banderas a schema:Person,
        ns1:NamedIndividual ;
    schema:name "Antonio Banderas" ;
    ns1:sameAs dbr:Antonio_Banderas ;
    foaf:isPrimaryTopicOf wiki:Antonio_Banderas ;
    twsse2:birthDate "1960-08-10"^^xsd:date ;
    twsse2:hasOccupation [ a twsse2:Occupation ;
            twsse2:name "director" ],
        [ a twsse2:Occupation ;
            twsse2:name "producer" ],
        [ a twsse2:Occupation ;
            twsse2:name "Actor" ] .


-------------

bueno ahi descomente para que se genere para todos los actores de links.
y veo que tira un error con la única ocupación distinta. la de Chris Pine.

pablo@xiaomi:/src/github/facu-infor/twss/entrega4$ python3 src/entrega.py 
Accediendo a http://dbpedia.org/resource/Millie_Bobby_Brown
http://dbpedia.org/resource/Millie_Bobby_Brown__PersonFunction__1
Accediendo a http://dbpedia.org/resource/Rebecca_Hall
http://dbpedia.org/resource/Rebecca_Hall__PersonFunction__1
Accediendo a http://dbpedia.org/resource/Charlie_Heaton
http://dbpedia.org/resource/Charlie_Heaton__PersonFunction__1
Accediendo a http://dbpedia.org/resource/Elizabeth_Debicki
http://dbpedia.org/resource/Elizabeth_Debicki__PersonFunction__1
Accediendo a http://dbpedia.org/resource/Antonio_Banderas
http://dbpedia.org/resource/Antonio_Banderas__PersonFunction__1
Accediendo a http://dbpedia.org/resource/Chris_Pine
http://dbpedia.org/resource/Chris_Pine__PersonFunction__1
http://dbpedia.org/resource/Film_Actor
Traceback (most recent call last):
  File "/src/github/facu-infor/twss/entrega4/src/entrega.py", line 144, in <module>
    triples = get_triples_to_add(gaux)
  File "/src/github/facu-infor/twss/entrega4/src/entrega.py", line 63, in get_triples_to_add
    triples.extend(triples2)
TypeError: 'NoneType' object is not iterable
pablo@xiaomi:/src/github/facu-infor/twss/entrega4$ 


debo debuggear para analizar por que Film_Actor tira error.


------

veo a ver que retorna Film_Actor
sigo toda la cadena de redirecciones.

pablo@xiaomi:~$ curl -H 'Accept: text/turtle' -I http://dbpedia.org/resource/Film_Actor
HTTP/1.1 303 See Other
Server: nginx/1.18.0
Date: Tue, 18 May 2021 14:29:22 GMT
Content-Type: text/html
Content-Length: 153
Connection: keep-alive
Location: https://dbpedia.org/resource/Film_Actor
Access-Control-Allow-Credentials: true
Access-Control-Allow-Methods: HEAD, GET, POST, OPTIONS
Access-Control-Allow-Headers: Depth,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Accept-Encoding

pablo@xiaomi:~$ curl -H 'Accept: text/turtle' -I https://dbpedia.org/resource/Film_Actor
HTTP/2 303 
date: Tue, 18 May 2021 14:29:40 GMT
content-type: text/turtle
content-length: 0
server: Virtuoso/08.03.3319 (Linux) x86_64-centos_6-linux-glibc2.12  VDB
tcn: choice
vary: negotiate,accept
alternates: {"/data/Film_Actor.atom" 0.500000 {type application/atom+xml}}, {"/data/Film_Actor.jrdf" 0.600000 {type application/rdf+json}}, {"/data/Film_Actor.jsod" 0.500000 {type application/odata+json}}, {"/data/Film_Actor.json" 0.600000 {type application/json}}, {"/data/Film_Actor.jsonld" 0.500000 {type application/ld+json}}, {"/data/Film_Actor.n3" 0.800000 {type text/n3}}, {"/data/Film_Actor.nt" 0.800000 {type text/rdf+n3}}, {"/data/Film_Actor.ntriples" 0.500000 {type application/n-triples}}, {"/data/Film_Actor.ttl" 0.700000 {type text/turtle}}, {"/data/Film_Actor.xml" 0.950000 {type application/rdf+xml}}
link: <http://creativecommons.org/licenses/by-sa/3.0/>;rel="license",<http://dbpedia.mementodepot.org/timegate/http://dbpedia.org/resource/Film_Actor>; rel="timegate"
location: http://dbpedia.org/data/Film_Actor.ttl
access-control-allow-credentials: true
access-control-allow-methods: HEAD, GET, POST, OPTIONS
access-control-allow-headers: Depth,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Accept-Encoding

pablo@xiaomi:~$ curl -H 'Accept: text/turtle' -I http://dbpedia.org/data/Film_Actor.ttl
HTTP/1.1 303 See Other
Server: nginx/1.18.0
Date: Tue, 18 May 2021 14:29:56 GMT
Content-Type: text/html
Content-Length: 153
Connection: keep-alive
Location: https://dbpedia.org/data/Film_Actor.ttl
Access-Control-Allow-Credentials: true
Access-Control-Allow-Methods: HEAD, GET, POST, OPTIONS
Access-Control-Allow-Headers: Depth,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Accept-Encoding

pablo@xiaomi:~$ curl -H 'Accept: text/turtle' -I https://dbpedia.org/data/Film_Actor.ttl
HTTP/2 200 
date: Tue, 18 May 2021 14:30:05 GMT
content-type: text/turtle; charset=UTF-8
content-length: 2896
server: Virtuoso/08.03.3319 (Linux) x86_64-centos_6-linux-glibc2.12  VDB
expires: Tue, 25 May 2021 14:30:05 GMT
link: <http://creativecommons.org/licenses/by-sa/3.0/>;rel="license",<http://dbpedia.org/data/Film_Actor.xml>; rel="alternate"; type="application/rdf+xml"; title="Structured Descriptor Document (RDF/XML format)", <http://dbpedia.org/data/Film_Actor.n3>; rel="alternate"; type="text/n3"; title="Structured Descriptor Document (N3/Turtle format)", <http://dbpedia.org/data/Film_Actor.json>; rel="alternate"; type="application/json"; title="Structured Descriptor Document (RDF/JSON format)", <http://dbpedia.org/data/Film_Actor.atom>; rel="alternate"; type="application/atom+xml"; title="OData (Atom+Feed format)", <http://dbpedia.org/data/Film_Actor.jsod>; rel="alternate"; type="application/odata+json"; title="OData (JSON format)", <http://dbpedia.org/page/Film_Actor>; rel="alternate"; type="text/html"; title="XHTML+RDFa", <http://dbpedia.org/resource/Film_Actor>; rel="http://xmlns.com/foaf/0.1/primaryTopic", <http://dbpedia.org/resource/Film_Actor>; rev="describedby", <http://dbpedia.mementodepot.org/timegate/http://dbpedia.org/data/Film_Actor.ttl>; rel="timegate"
x-sparql-default-graph: http://dbpedia.org
content-disposition: filename=sparql_2021-05-18_14-03-01Z.ttl
cache-control: max-age=604800
access-control-allow-credentials: true
access-control-allow-methods: HEAD, GET, POST, OPTIONS
access-control-allow-headers: Depth,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Accept-Encoding
accept-ranges: bytes

me retorna un turtle ok.
per veo que en ese dataset no me define dbo:title
si no que define rdfs:label

dbr:Film_Actor	rdf:type	dbo:PersonFunction .
@prefix rdfs:	<http://www.w3.org/2000/01/rdf-schema#> .
dbr:Film_Actor	rdfs:label	"Film Actor"@en ;


cuando en otros turtles si indica la ocupación con dbo:title

pablo@xiaomi:~$ curl -H 'accept: text/turtle' https://dbpedia.org/data/Robert_Pattinson__PersonFunction__1.ttl
@prefix rdf:	<http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix dbr:	<http://dbpedia.org/resource/> .
@prefix dbo:	<http://dbpedia.org/ontology/> .
dbr:Robert_Pattinson__PersonFunction__1	rdf:type	dbo:PersonFunction .
@prefix owl:	<http://www.w3.org/2002/07/owl#> .
dbr:Robert_Pattinson__PersonFunction__1	rdf:type	owl:Thing ;
	owl:sameAs	dbr:Robert_Pattinson__PersonFunction__1 ;
	dbo:title	"Actor"@en .
dbr:Robert_Pattinson	dbo:occupation	dbr:Robert_Pattinson__PersonFunction__1 .


ajusto el script para tomar también de rdfs:label

funcionó bien. asi que saque las ocupaciones teniendo en cuenta las 2 propieadades.
dbo:title
rdfs:label

----

pero algo raro me dejo en Chris_Pine el rdfs:label.
mmm algún error tengo.

twssd:Chris_Pine a schema:Person,
        ns1:NamedIndividual ;
    rdfs:label "Film Actor"@en ;
    schema:image <https://resizing.flixster.com/kXDRe1jUWEU8UFkdf8JhRPMUG8s=/660x990/v1.bjs3NTYxMDQ7ajsxODgxODsxMjAwOzY2MDs5OTA> ;
    schema:mainEntityOfPage <https://www.ecartelera.com/personas/chris-pine> ;
    schema:name "Chris Pine" ;
    schema:sameAs <https://www.rottentomatoes.com/celebrity/christopher_pine> ;
    schema:url <https://www.imdb.com/name/nm1517976>,
        <https://www.metacritic.com/person/chris-pine> ;
    ns1:sameAs dbr:Chris_Pine ;
    foaf:isPrimaryTopicOf wiki:Chris_Pine ;
    twsse2:birthDate "1980-08-26"^^xsd:date ;
    twsse2:hasOccupation [ a twsse2:Occupation ;
            twsse2:name "Film Actor" ] .

twssd:Gal_Gadot a schema:Person,
        ns1:NamedIndividual ;
    schema:image <https://resizing.flixster.com/QUtKfz3anQMHFQQruCGKVWbv1Kc=/633x704/v1.cjs0Mjc1NjtwOzE4NzY1OzEyMDA7NjMzOzcwNA> ;
    schema:mainEntityOfPage <https://www.ecartelera.com/personas/gal-gadot> ;
    schema:name "Gal Gadot" ;
    schema:sameAs <https://www.rottentomatoes.com/celebrity/gal-gadot> ;
    schema:url <https://www.imdb.com/name/nm2933757>,
        <https://www.metacritic.com/person/gal-gadot> ;
    ns1:sameAs dbr:Gal_Gadot ;
    foaf:isPrimaryTopicOf wiki:Gal_Gadot ;
    twsse2:birthDate "1985-04-30"^^xsd:date ;
    twsse2:hasOccupation [ a twsse2:Occupation ;
            twsse2:name "Miss Israel2004" ],
        [ a twsse2:Occupation ;
            twsse2:name "model" ],
        [ a twsse2:Occupation ;
            twsse2:name "Actress" ] .


----

la función de Chris_Pine esta ok. con el title.

pablo@xiaomi:~$ curl -H 'accept: text/turtle' https://dbpedia.org/data/Chris_Pine__PersonFunction__1.ttl
@prefix dbo:	<http://dbpedia.org/ontology/> .
@prefix dbr:	<http://dbpedia.org/resource/> .
dbr:Chris_Pine	dbo:occupation	dbr:Chris_Pine__PersonFunction__1 .
@prefix rdf:	<http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix owl:	<http://www.w3.org/2002/07/owl#> .
dbr:Chris_Pine__PersonFunction__1	rdf:type	owl:Thing ,
		dbo:PersonFunction ;
	owl:sameAs	dbr:Chris_Pine__PersonFunction__1 ;
	dbo:title	"Film Actor"@en .


ahora me fijo el recurso de Chris_Pine como persona:


        dbo:occupation  dbr:Chris_Pine__PersonFunction__1 ,
                dbr:Film_Actor .

ahi esta. esta definido con 2 ocupaciones. una de las cuales solo tiene un rdfs:Label y no tiene dbo:title
cambio el codigo para que vaya por cada una de las opcupaciones desreferenciadas obteniendo los titles. lo demás lo ignore.

----

funcionó perfecto.

twssd:Chris_Pine a schema:Person,
        ns1:NamedIndividual ;
    schema:image <https://resizing.flixster.com/kXDRe1jUWEU8UFkdf8JhRPMUG8s=/660x990/v1.bjs3NTYxMDQ7ajsxODgxODsxMjAwOzY2MDs5OTA> ;
    schema:mainEntityOfPage <https://www.ecartelera.com/personas/chris-pine> ;
    schema:name "Chris Pine" ;
    schema:sameAs <https://www.rottentomatoes.com/celebrity/christopher_pine> ;
    schema:url <https://www.imdb.com/name/nm1517976>,
        <https://www.metacritic.com/person/chris-pine> ;
    ns1:sameAs dbr:Chris_Pine ;
    foaf:isPrimaryTopicOf wiki:Chris_Pine ;
    twsse2:birthDate "1980-08-26"^^xsd:date ;
    twsse2:hasOccupation [ a twsse2:Occupation ;
            twsse2:name "Film Actor" ] .

twssd:Gal_Gadot a schema:Person,
        ns1:NamedIndividual ;
    schema:image <https://resizing.flixster.com/QUtKfz3anQMHFQQruCGKVWbv1Kc=/633x704/v1.cjs0Mjc1NjtwOzE4NzY1OzEyMDA7NjMzOzcwNA> ;
    schema:mainEntityOfPage <https://www.ecartelera.com/personas/gal-gadot> ;
    schema:name "Gal Gadot" ;
    schema:sameAs <https://www.rottentomatoes.com/celebrity/gal-gadot> ;
    schema:url <https://www.imdb.com/name/nm2933757>,
        <https://www.metacritic.com/person/gal-gadot> ;
    ns1:sameAs dbr:Gal_Gadot ;
    foaf:isPrimaryTopicOf wiki:Gal_Gadot ;
    twsse2:birthDate "1985-04-30"^^xsd:date ;
    twsse2:hasOccupation [ a twsse2:Occupation ;
            twsse2:name "Actress" ],
        [ a twsse2:Occupation ;
            twsse2:name "model" ],
        [ a twsse2:Occupation ;
            twsse2:name "Miss Israel2004" ] .


-----

modifico para que tome los archvios por linea de compando.
y pruebo la ejecución.
debería tirar a stdout solo el turtle completo.


pablo@xiaomi:/src/github/facu-infor/twss/entrega4$ python3 src/entrega.py ./data/dataset-original.ttl ./data/links.ttl 
Y
pablo@xiaomi:/src/github/facu-infor/twss/entrega4/src$ python3 entrega.py ../data/dataset-original.ttl ../data/links.ttl 

funcionó perfecto.
ya tengo cerrada la entrega.

----

pruebo generar el dataset final.

pablo@xiaomi:/src/github/facu-infor/twss/entrega4/src$ python3 entrega.py ../data/dataset-original.ttl ../data/links.ttl > ../data/dataset-enriquecido.ttl

----

pero protegé me los muestra mal a los resultados.
me muestra un 
owl:Thing 
    Occupation <--- iri = https://raw.githubusercontent.com/pablodanielrey/twss/master/owl/twss_schema_extended2.ttl#Occupation
    schema:Intangible
        schema:Occupation       <-- http://schema.org/Occupation


cuando nunca yo uso Occupation dentro de mi espacio de nomrbes de la ontología!!
el problema viene dado de rdbflib cuando me genera los types de las ocupaciones en mi dataset final.

@prefix : <https://raw.githubusercontent.com/pablodanielrey/twss/master/owl/twss_schema_extended2.ttl#> .


twssd:Alexander_Skarsgård ns1:sameAs dbr:Alexander_Skarsgård ;
    foaf:isPrimaryTopicOf wiki:Alexander_Skarsgård ;
    :birthDate "1976-08-25"^^xsd:date ;
    :hasOccupation [ a :Occupation ;
            :name "Actor" ] .

o sea no usa el prefijo schema:Occupation!!! si no que el prefijo :

encontré el problema!!: para generar las ocupaciones en el código yo uso:


change_to_my_ontology(subject, triples)
       occupation_to_my_ontology(schema, triple)

                o = BNode(f'occupation_{str(uuid.uuid4())}')
                triples.extend([
                    (o, RDF.type, schema.Occupation),
                    (o, schema.name, Literal(o_name.strip())), 
                    (st, schema.hasOccupation, o)
                ])

le estaba pasando mal el namespaces. ahora si usa namespace schema:Occupation

---

ahora no me muestra individuals del tipo schema:Occupation
aunque en el dataset final tenga:

twssd:Antonio_Banderas a schema:Person,
        ns1:NamedIndividual ;
    schema:birthDate "1960-08-10"^^xsd:date ;
    schema:hasOccupation [ a schema:Occupation ;
            schema:name "producer" ],
        [ a schema:Occupation ;
            schema:name "Actor" ],
        [ a schema:Occupation ;
            schema:name "director" ] ;
    schema:name "Antonio Banderas" ;
    ns1:sameAs dbr:Antonio_Banderas ;
    foaf:isPrimaryTopicOf wiki:Antonio_Banderas .




-----

pruebo generar un archivo de ejemplo para leerlo con protegé a ver si lo interpreta ok.

este ejemplo no muestra ok los individuals de Occupation.
si me muestra ok a Banderas, pero no los Occupation.
me muestra como nodos autogenerados dentro de Banderas solamente
asi que algo raro está haciendo con las ontologías y las importaciones que evidentemente no se manejar.


@prefix dbr: <http://dbpedia.org/resource/> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix ns1: <http://www.w3.org/2002/07/owl#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix schema: <http://schema.org/> .
@prefix twssd: <https://raw.githubusercontent.com/pablodanielrey/twss/master/owl/data/> .
@prefix twsss: <https://raw.githubusercontent.com/pablodanielrey/twss/master/owl/twss_schema_extended.ttl#> .
@prefix wiki: <http://en.wikipedia.org/wiki/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

<https://raw.githubusercontent.com/pablodanielrey/twss/master/owl/twss_schema_extended2.ttl> a ns1:Ontology ;
    ns1:imports <https://raw.githubusercontent.com/pablodanielrey/twss/master/owl/twss_schema_extended.ttl> .

<https://raw.githubusercontent.com/pablodanielrey/twss/master/owl/twss_schema.ttl> a ns1:Ontology .

<https://raw.githubusercontent.com/pablodanielrey/twss/master/owl/twss_schema_extended.ttl> a ns1:Ontology ;
    ns1:imports <https://raw.githubusercontent.com/pablodanielrey/twss/master/owl/twss_schema.ttl> .



twssd:Antonio_Banderas a schema:Person,
        ns1:NamedIndividual ;
    schema:birthDate "1960-08-10"^^xsd:date ;
    schema:hasOccupation [ a schema:Occupation ;
            schema:name "producer" ],
        [ a schema:Occupation ;
            schema:name "Actor" ],
        [ a schema:Occupation ;
            schema:name "director" ] ;
    schema:name "Antonio Banderas" ;
    ns1:sameAs dbr:Antonio_Banderas ;
    foaf:isPrimaryTopicOf wiki:Antonio_Banderas .


----

voy a intentar generar una ontología unificada final (lo que debería haber hecho en el trabajo anterior, pero 
me gustaba probar con las importaciones de ontologías).

la cree como twss_final.ttl
y protegé la carga perfecto, con todos las data porperties y las object properties
pruebo cargar el ejemplo usando esa ontología a ver si me lo carga


y no hay caso.
usando esa ontología, para el invididual de Antonio_Banderas
NO me muestra las occupations como individuals!!.

twssd:Antonio_Banderas a schema:Person,
        owl:NamedIndividual ;
    schema:birthDate "1960-08-10"^^xsd:date ;
    schema:hasOccupation [ a schema:Occupation ;
            schema:name "producer" ],
        [ a schema:Occupation ;
            schema:name "Actor" ],
        [ a schema:Occupation ;
            schema:name "director" ] ;
    schema:name "Antonio Banderas" ;
    owl:sameAs dbr:Antonio_Banderas ;
    foaf:isPrimaryTopicOf wiki:Antonio_Banderas .


o sea esos blank nodes NO me los muestra como individuals. 
si los veo con ids autogenerados cuando analizo Antonio_Banderas, pero no como instancias de schema:Occupation
cuando voy a ver esa funcionalidad dentro de protegé.

-------

modifico el dataset original para usar la ontología unificada twss_final.ttl.
asi es mas simple para alejandro y diego corregir.

-----

modifico el script nuevamente para tomar solo 2 parámetros. ya que ahora la ontología está actualizada y solo es una.
<https://raw.githubusercontent.com/pablodanielrey/twss/master/owl/twss_final.ttl> a owl:Ontology .


y limpie el dataset original porque tenía una mezcla de definiciones de clases y propieades y definiciones de individuals.
deje solamente los individuals.
porque me hacía cosas raras. me redefinía cosas en protegé.

-----

al sacarle las definiciones de clases y de propieades dentor del archivo de dataset-original.ttl
me hizo plano la jerarquía!!.
claramente no la toma automáticamente desde la url que define esa ontología protegé.

<https://raw.githubusercontent.com/pablodanielrey/twss/master/owl/twss_final.ttl> a owl:Ontology .

no va y la lee.
queda vacía la ontología dentro de protegé.
asi que agrego twss_final.ttl al archivo dataset-original.ttl
asi debería quedar completa la ontología y levantarla correctamente protegé.
seguramente eso fue mi problema desde el principio y problemas con el tp anterior también.

---------------


antes que eso voy a probar hacer lo siguiente.
en el dataset-original.ttl voy a definir como que se estuviera definiendo una ontología donde se almacenan los datos solamente.
y esta importa la ontología que tiene las clases  y propieades.

<https://raw.githubusercontent.com/pablodanielrey/twss/master/owl/data/> a owl:Ontology ;
            owl:imports <https://raw.githubusercontent.com/pablodanielrey/twss/master/owl/twss_final.ttl> .

a ver si eso funciona ok para protegé?.

---

NO FUNCIONO!!.
hace cualquier cosa protegé.
asi que vuelvo a mi idea original.
tomo y agrego la definición de las clases y propieades de la ontología dentor del archivo dataset-original.ttl

ahora protegé me lo lee correctamente, las clases tienen la hernecia que deberían tener, etc.
ejecuto por última vez nuevamente el script a ver si genera todo ok.

pablo@xiaomi:/src/github/facu-infor/twss/entrega4/src$ python3 entrega.py ../data/dataset-original.ttl ../data/links.ttl > ../data/dataset-enriquecido.ttl

todo perfecto generado.
así que era mas simple así.

